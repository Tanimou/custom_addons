<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    
    <!-- 
        Pickup Status Selection in TicketScreen
        Adds a selection field between status badge and delete button for self-order paid orders
        
        Target location in original template (lines 67-69):
        <td class="align-middle text-end">...</td>  <- Status badge (Payé)
        <td class="text-end delete-column" name="delete-column">...</td>  <- Delete button
        
        We insert BEFORE delete-column using name="delete-column" as anchor
    -->
    <t t-name="custom_la_duree_palisades.TicketScreenPickupStatus" t-inherit="point_of_sale.TicketScreen" t-inherit-mode="extension">
        
        <!-- Desktop view: Add pickup status column before delete button (after status badge) -->
        <xpath expr="//td[@name='delete-column']" position="before">
            <td class="align-middle text-center pickup-status-cell">
                <t t-if="order.state === 'paid' and order.source === 'self_order'">
                    <select class="form-select form-select-sm pickup-status-select"
                            style="width: auto; min-width: 110px;"
                            t-att-value="order.pickup_status || 'waiting'"
                            t-on-change="(ev) => this.onPickupStatusChange(order, ev)">
                        <option value="waiting" t-att-selected="(order.pickup_status || 'waiting') === 'waiting' ? 'selected' : undefined">En attente</option>
                        <option value="picked_up" t-att-selected="order.pickup_status === 'picked_up' ? 'selected' : undefined">Retiré</option>
                    </select>
                </t>
            </td>
        </xpath>
        
        <!-- Mobile view: Add pickup status after the status badge div -->
        <xpath expr="//div[@name='delete-column']" position="before">
            <div class="p-2 d-flex align-items-center pickup-status-cell" t-if="order.state === 'paid' and order.source === 'self_order'">
                <select class="form-select form-select-sm pickup-status-select"
                        style="font-size: 0.75rem; padding: 2px 6px; width: auto; min-width: 90px;"
                        t-att-value="order.pickup_status || 'waiting'"
                        t-on-change="(ev) => this.onPickupStatusChange(order, ev)">
                    <option value="waiting" t-att-selected="(order.pickup_status || 'waiting') === 'waiting' ? 'selected' : undefined">En attente</option>
                    <option value="picked_up" t-att-selected="order.pickup_status === 'picked_up' ? 'selected' : undefined">Retiré</option>
                </select>
            </div>
        </xpath>
        
    </t>
    
</templates>
