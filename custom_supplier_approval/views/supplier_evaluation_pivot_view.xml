<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Supplier Evaluation Pivot View -->
    <record id="view_supplier_evaluation_pivot" model="ir.ui.view">
        <field name="name">supplier.evaluation.pivot</field>
        <field name="model">supplier.evaluation</field>
        <field name="arch" type="xml">
            <pivot string="Analyse des Évaluations" sample="1" 
                   disable_linking="False" display_quantity="True">
                <!-- Default grouping: Suppliers as rows, Months as columns -->
                <field name="partner_id" type="row"/>
                <field name="evaluation_date" interval="month" type="col"/>
                
                <!-- Measures: Overall score (only numeric field available) -->
                <field name="overall_score" type="measure"/>
                
                <!-- Rating fields available for grouping but not as measures (they're Selection fields) -->
                <!-- Use overall_score to see average, min, max satisfaction rates -->
            </pivot>
        </field>
    </record>

    <!-- Supplier Evaluation Pivot Action -->
    <record id="action_supplier_evaluation_pivot" model="ir.actions.act_window">
        <field name="name">Analyse des Évaluations</field>
        <field name="res_model">supplier.evaluation</field>
        <field name="view_mode">pivot,graph,list,form</field>
        <field name="context">{
            'search_default_group_by_partner': 1,
            'search_default_group_by_month': 1,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Aucune évaluation à analyser
            </p>
            <p>
                Cette vue pivot permet d'analyser les évaluations de fournisseurs selon plusieurs dimensions :
                <ul>
                    <li>Par fournisseur : Comparez les performances entre fournisseurs</li>
                    <li>Par période : Suivez l'évolution des scores dans le temps</li>
                    <li>Par évaluateur : Identifiez les tendances par personne</li>
                    <li>Par critère : Analysez chaque critère individuellement</li>
                </ul>
            </p>
        </field>
    </record>

    <!-- Add menu item for Pivot Analysis -->
    <record id="menu_supplier_evaluation_analysis" model="ir.ui.menu">
        <field name="name">Analyse Pivot</field>
        <field name="parent_id" ref="menu_supplier_approval_reports"/>
        <field name="action" ref="action_supplier_evaluation_pivot"/>
        <field name="sequence">10</field>
    </record>

    <!-- Search view with additional group by options -->
    <!-- <record id="view_supplier_evaluation_search_analysis" model="ir.ui.view">
        <field name="name">supplier.evaluation.search.analysis</field>
        <field name="model">supplier.evaluation</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <search string="Rechercher Évaluations">
                
                <filter string="Excellentes (≥ 75%)" name="filter_excellent" 
                        domain="[('overall_score', '&gt;=', 75)]"/>
                <filter string="Bonnes (50-74%)" name="filter_good" 
                        domain="[('overall_score', '&gt;=', 50), ('overall_score', '&lt;', 75)]"/>
                <filter string="Faibles (&lt; 50%)" name="filter_poor" 
                        domain="[('overall_score', '&lt;', 50)]"/>
                
                <separator/>
                
                
                <field name="partner_id"/>
                <field name="evaluated_by"/>
                <field name="evaluation_date"/>
                
                <group expand="0" string="Grouper Par">
                    <filter string="Fournisseur" name="group_by_partner" 
                            context="{'group_by': 'partner_id'}"/>
                    <filter string="Évaluateur" name="group_by_evaluator" 
                            context="{'group_by': 'evaluated_by'}"/>
                    <filter string="Mois" name="group_by_month" 
                            context="{'group_by': 'evaluation_date:month'}"/>
                    <filter string="Trimestre" name="group_by_quarter" 
                            context="{'group_by': 'evaluation_date:quarter'}"/>
                    <filter string="Année" name="group_by_year" 
                            context="{'group_by': 'evaluation_date:year'}"/>
                </group>
            </search>
        </field>
    </record> -->

</odoo>
