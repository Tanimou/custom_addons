<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- Customize ClosePosPopup: Hide payment summary and make cash input read-only -->
    <t t-name="custom_pos.ClosePosPopupExtension" t-inherit="point_of_sale.ClosePosPopup" t-inherit-mode="extension">
        
        <!-- 0. Hide the orders count and amount in header (e.g. "3 commandes: $ 465,75") -->
        <xpath expr="//div[hasclass('total-orders')]" position="attributes">
            <attribute name="style">display: none !important;</attribute>
        </xpath>
        
        <!-- 1. Hide the payment-methods-overview section using style (not remove, to preserve xpath targets for other modules) -->
        <xpath expr="//div[hasclass('payment-methods-overview')]" position="attributes">
            <attribute name="style">display: none !important;</attribute>
        </xpath>
        
        <!-- 2. Hide the hr separator -->
        <xpath expr="//hr" position="attributes">
            <attribute name="style">display: none !important;</attribute>
        </xpath>
        
        <!-- 3. Replace Cash Count input with a read-only version (no auto-fill button) -->
        <xpath expr="//div[hasclass('mb-3')][.//Input[contains(@class, 'cash-input')]]" position="replace">
            <div t-if="pos.config.cash_control" class="mb-3">
                <label class="form-label">Comptage de caisse</label>
                <div class="d-flex w-100 gap-2 mt-1">
                    <!-- Read-only input: displays the counted value but cannot be edited directly -->
                    <input type="text" 
                           class="form-control cash-input w-100 bg-light" 
                           t-att-value="state.payments[props.default_cash_details.id]?.counted || '0'"
                           readonly="readonly"
                           disabled="disabled"/>
                    <!-- Money details popup button (coins/notes counting) -->
                    <button class="icon fa fa-money btn btn-secondary" 
                            t-on-click="openDetailsPopup" 
                            title="Comptage des billets"/>
                    <!-- Auto-fill button REMOVED per user request -->
                </div>
            </div>
        </xpath>
        
        <!-- 3b. Replace non-cash payment method inputs (Wave, Orange, etc.) with read-only versions -->
        <!-- Remove the "x" clear button and clone button, make field readonly -->
        <xpath expr="//div[hasclass('w-100') and hasclass('mb-3') and @t-foreach='props.non_cash_payment_methods' and not(ancestor::div[hasclass('payment-methods-overview')])]" position="replace">
            <div class="w-100 mb-3" t-foreach="props.non_cash_payment_methods" t-as="pm" t-key="pm.id">
                <t t-set="_showDiff" t-value="pm.type === 'bank' and pm.number !== 0" />
                <t t-if="_showDiff">
                    <span><t t-esc="pm.name" /> Nombre</span>
                    <div class="d-flex w-100 gap-2 mt-1">
                        <!-- Read-only input: shows the payment method total, no editing allowed -->
                        <input type="text" 
                               class="form-control w-100 bg-light" 
                               t-att-value="state.payments[pm.id]?.counted || env.utils.formatCurrency(pm.amount, false)"
                               readonly="readonly"
                               disabled="disabled"/>
                        <!-- Clone/auto-fill button REMOVED per user request -->
                        <!-- Clear (x) button REMOVED per user request -->
                    </div>
                </t>
            </div>
        </xpath>
        
        <!-- 4. Make closing notes textarea readonly -->
        <xpath expr="//textarea[hasclass('closing-notes')]" position="attributes">
            <attribute name="readonly">readonly</attribute>
            <attribute name="class">closing-notes form-control bg-light</attribute>
        </xpath>
        
        <!-- 5. Reorganize footer buttons: Cash In/Out, Prél, Clôturer, Ignorer -->
        <xpath expr="//t[@t-set-slot='footer']" position="replace">
            <t t-set-slot="footer">
                <div class="w-100 d-flex flex-wrap justify-content-between gap-2">
                    <div class="d-flex gap-2">
                        <!-- Cash In/Out button first -->
                        <button t-if="pos.showCashMoveButton" 
                                class="button btn btn-info btn-lg" 
                                t-on-click="() => this.cashMove()">
                            Cash entrant/sortant
                        </button>
                        <!-- New Prél button - opens money details popup -->
                        <button class="button btn btn-success btn-lg" 
                                t-on-click="openDetailsPopup"
                                title="Prélèvement - Comptage des espèces">
                            Prél
                        </button>
                    </div>
                    <div class="d-flex gap-2">
                        <!-- Close button renamed to Clôturer -->
                        <button class="button highlight btn btn-primary btn-lg" 
                                t-att-disabled="!canConfirm()" 
                                t-on-click="confirm">
                            Clôturer
                        </button>
                        <!-- Ignorer (Discard) button -->
                        <button class="button btn btn-secondary btn-lg" 
                                t-att-disabled="!canCancel()" 
                                t-on-click="cancel">
                            Ignorer
                        </button>
                    </div>
                </div>
            </t>
        </xpath>
        
    </t>

</templates>
