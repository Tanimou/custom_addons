<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="fleet_fuel_expense_view_tree" model="ir.ui.view">
            <field name="name">fleet.fuel.expense.tree</field>
            <field name="model">fleet.fuel.expense</field>
            <field name="arch" type="xml">
                <list string="Dépenses carburant" decoration-danger="state == 'rejected'" decoration-success="state == 'validated'">
                    <field name="name"/>
                    <field name="expense_date"/>
                    <field name="card_id"/>
                    <field name="vehicle_id"/>
                    <field name="driver_id"/>
                    <field name="station_partner_id"/>
                    <field name="liter_qty" sum="Total litres"/>
                    <field name="amount" sum="Total montant"/>
                    <field name="state" widget="badge"/>
                </list>
            </field>
        </record>

        <record id="fleet_fuel_expense_view_form" model="ir.ui.view">
            <field name="name">fleet.fuel.expense.form</field>
            <field name="model">fleet.fuel.expense</field>
            <field name="arch" type="xml">
                <form string="Dépense carburant">
                    <header>
                        <button name="action_submit" type="object" string="Soumettre" class="btn-primary" invisible="state != 'draft'"/>
                        <button name="action_validate" type="object" string="Valider" class="btn-success" invisible="state not in ('draft', 'submitted')"/>
                        <button name="action_reject" type="object" string="Rejeter" class="btn-outline-danger" invisible="state not in ('draft', 'submitted')"/>
                        <button name="action_reset_to_draft" type="object" string="Remettre en brouillon" invisible="state != 'rejected'"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,submitted,validated,rejected"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="name" readonly="1"/>
                                <field name="card_id" options="{'no_open': True}"/>
                                <field name="vehicle_id" options="{'no_open': True}"/>
                                <field name="driver_id" options="{'no_open': True}"/>
                                <field name="expense_date"/>
                                <field name="station_partner_id" options="{'no_open': True}"/>
                                <field name="analytic_account_id"/>
                                <field name="budget_line_id"/>
                                <field name="batch_id" readonly="1"/>
                            </group>
                            <group>
                                <field name="liter_qty"/>
                                <field name="price_per_liter" widget="monetary" options="{'currency_field': 'currency_id'}" readonly="1"/>
                                <field name="amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="company_id" groups="base.group_multi_company"/>
                                <field name="currency_id" groups="base.group_multi_currency"/>
                                <field name="odometer"/>
                                <field name="submitted_by_id" readonly="1"/>
                                <field name="validated_by_id" readonly="1"/>
                                <field name="validated_date" readonly="1"/>
                            </group>
                        </group>
                        <group>
                            <field name="receipt_attachment" filename="receipt_filename" widget="binary"/>
                            <field name="receipt_filename" readonly="1"/>
                        </group>
                        <field name="notes" widget="html" placeholder="Commentaires"/>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <record id="fleet_fuel_expense_view_search" model="ir.ui.view">
            <field name="name">fleet.fuel.expense.search</field>
            <field name="model">fleet.fuel.expense</field>
            <field name="arch" type="xml">
                <search string="Dépenses carburant">
                    <field name="name"/>
                    <field name="card_id"/>
                    <field name="vehicle_id"/>
                    <field name="driver_id"/>
                    <field name="station_partner_id"/>
                    <field name="state"/>
                    <filter string="Validées" name="filter_validated" domain="[('state', '=', 'validated')]"/>
                    <filter string="Rejetées" name="filter_rejected" domain="[('state', '=', 'rejected')]"/>
                    <filter string="Par carte" name="group_card" context="{'group_by': 'card_id'}"/>
                    <filter string="Par véhicule" name="group_vehicle" context="{'group_by': 'vehicle_id'}"/>
                    <filter string="Par station" name="group_station" context="{'group_by': 'station_partner_id'}"/>
                </search>
            </field>
        </record>

        <record id="fleet_fuel_expense_view_pivot" model="ir.ui.view">
            <field name="name">fleet.fuel.expense.pivot</field>
            <field name="model">fleet.fuel.expense</field>
            <field name="arch" type="xml">
                <pivot string="Analyse dépenses carburant">
                    <field name="amount" type="measure"/>
                    <field name="liter_qty" type="measure"/>
                    <field name="card_id" type="col"/>
                    <field name="vehicle_id" type="row"/>
                    <field name="station_partner_id" type="row" optional="hide"/>
                </pivot>
            </field>
        </record>

        <record id="action_fleet_fuel_expense" model="ir.actions.act_window">
            <field name="name">Dépenses carburant</field>
            <field name="res_model">fleet.fuel.expense</field>
            <field name="view_mode">list,form,pivot</field>
            <field name="search_view_id" ref="custom_fleet_fuel_management.fleet_fuel_expense_view_search"/>
            <field name="context">{"default_state": "draft"}</field>
        </record>
    </data>
</odoo>
