<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="fleet_fuel_expense_batch_view_tree" model="ir.ui.view">
            <field name="name">fleet.fuel.expense.batch.tree</field>
            <field name="model">fleet.fuel.expense.batch</field>
            <field name="arch" type="xml">
                <list string="Lots d'import" decoration-danger="state == 'error'" decoration-muted="state == 'draft'">
                    <field name="name"/>
                    <field name="import_filename"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <field name="state" widget="badge"/>
                    <field name="line_count"/>
                    <field name="success_count"/>
                    <field name="error_count"/>
                    <field name="started_at"/>
                    <field name="finished_at"/>
                </list>
            </field>
        </record>

        <record id="fleet_fuel_expense_batch_view_form" model="ir.ui.view">
            <field name="name">fleet.fuel.expense.batch.form</field>
            <field name="model">fleet.fuel.expense.batch</field>
            <field name="arch" type="xml">
                <form string="Lot d'import">
                    <header>
                        <button name="action_view_expenses" type="object" string="Voir les dépenses" class="btn-link" invisible="success_count == 0"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,processing,done,error"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="import_filename" readonly="1"/>
                                <field name="company_id" groups="base.group_multi_company"/>
                                <field name="user_id" readonly="1"/>
                            </group>
                            <group>
                                <field name="line_count" readonly="1"/>
                                <field name="success_count" readonly="1"/>
                                <field name="error_count" readonly="1"/>
                                <field name="started_at" readonly="1"/>
                                <field name="finished_at" readonly="1"/>
                            </group>
                        </group>
                        <group string="Journal">
                            <field name="log_message" widget="text" readonly="1" placeholder="Journal des opérations"/>
                        </group>
                        <notebook>
                            <page string="Lignes importées">
                                <field name="line_ids" readonly="1" nolabel="1">
                                    <list string="Lignes importées">
                                        <field name="sequence"/>
                                        <field name="state" widget="badge"/>
                                        <field name="message"/>
                                        <field name="expense_id"/>
                                        <field name="import_hash"/>
                                    </list>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="fleet_fuel_expense_batch_view_search" model="ir.ui.view">
            <field name="name">fleet.fuel.expense.batch.search</field>
            <field name="model">fleet.fuel.expense.batch</field>
            <field name="arch" type="xml">
                <search string="Lots d'import">
                    <field name="name"/>
                    <field name="import_filename"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <field name="state"/>
                    <filter string="Terminé" name="filter_done" domain="[('state', '=', 'done')]"/>
                    <filter string="En erreur" name="filter_error" domain="[('state', '=', 'error')]"/>
                    <filter string="Par société" name="group_company" context="{'group_by': 'company_id'}"/>
                </search>
            </field>
        </record>

        <record id="action_fleet_fuel_expense_batch" model="ir.actions.act_window">
            <field name="name">Lots d'import</field>
            <field name="res_model">fleet.fuel.expense.batch</field>
            <field name="view_mode">list,form</field>
            <field name="search_view_id" ref="custom_fleet_fuel_management.fleet_fuel_expense_batch_view_search"/>
        </record>

        <record id="fleet_fuel_expense_import_wizard_view_form" model="ir.ui.view">
            <field name="name">fleet.fuel.expense.import.wizard.form</field>
            <field name="model">fleet.fuel.expense.import.wizard</field>
            <field name="arch" type="xml">
                <form string="Importer des dépenses">
                    <sheet>
                        <group>
                            <field name="data_file" filename="filename" widget="binary" options="{'accepted_file_extensions': '.csv,.xls,.xlsx'}"/>
                            <field name="filename" invisible="1"/>
                            <field name="company_id"/>
                            <field name="auto_validate"/>
                            <field name="batch_id" domain="[('company_id', '=', company_id)]"/>
                            <field name="note" widget="text" placeholder="Commentaires"/>
                        </group>
                    </sheet>
                    <footer>
                        <button name="action_import" type="object" string="Importer" class="btn-primary"/>
                        <button string="Annuler" special="cancel" class="btn-secondary"/>
                    </footer>
                </form>
            </field>
        </record>

        <record id="action_fleet_fuel_expense_import" model="ir.actions.act_window">
            <field name="name">Importer des dépenses</field>
            <field name="res_model">fleet.fuel.expense.import.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="custom_fleet_fuel_management.fleet_fuel_expense_import_wizard_view_form"/>
            <field name="target">new</field>
            <field name="context">{"default_auto_validate": True}</field>
            <field name="binding_model_id" ref="model_fleet_fuel_expense"/>
            <field name="binding_view_types">list</field>
        </record>
    </data>
</odoo>
