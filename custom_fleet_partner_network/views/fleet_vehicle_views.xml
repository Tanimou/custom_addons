<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Extension fleet.vehicle avec partenaires -->
        
        <record id="fleet_vehicle_view_form_partner_network" model="ir.ui.view">
            <field name="name">fleet.vehicle.form.partner.network</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_view_form"/>
            <field name="arch" type="xml">
                
                <!-- Onglet Administration: Partenaires -->
                <xpath expr="//notebook" position="inside">
                    <page string="Administration" name="page_administration">
                        
                        <!-- Section: Assurance -->
                        <group string="Assurance" name="group_insurance">
                            <group name="group_insurance_partner">
                                <field name="insurance_partner_id"
                                    domain="[('partner_type', '=', 'assureur'), ('company_id', 'in', [company_id, False])]"
                                    context="{'default_partner_type': 'assureur', 'default_company_id': company_id}"
                                    options="{'no_create': True}"
                                    help="Compagnie d'assurance actuellement active"/>
                            </group>
                            <group name="group_insurance_actions">
                                <button name="action_view_insurance_details"
                                    type="object"
                                    string="Voir Assureur"
                                    class="btn-secondary"
                                    icon="fa-building-o"
                                    invisible="not insurance_partner_id"/>
                            </group>
                        </group>
                        
                        <separator/>
                        
                        <!-- Section: Garages Agréés -->
                        <group string="Garages Agréés" name="group_garages">
                            <field name="garage_partner_ids"
                                widget="many2many_tags"
                                domain="[('partner_type', '=', 'garage'), ('company_id', 'in', [company_id, False])]"
                                context="{'default_partner_type': 'garage', 'default_company_id': company_id}"
                                placeholder="Sélectionner les garages autorisés pour ce véhicule..."
                                help="Liste des garages agréés pour l'entretien de ce véhicule"
                                nolabel="1"/>
                            <field name="garage_count" invisible="1"/>
                        </group>
                        
                        <separator/>
                        
                        <!-- Section: Remorqueurs Agréés -->
                        <group string="Remorqueurs Agréés" name="group_tow_partners">
                            <field name="tow_partner_ids"
                                widget="many2many_tags"
                                domain="[('partner_type', '=', 'remorqueur'), ('company_id', 'in', [company_id, False])]"
                                context="{'default_partner_type': 'remorqueur', 'default_company_id': company_id}"
                                placeholder="Sélectionner les remorqueurs autorisés pour ce véhicule..."
                                help="Liste des remorqueurs agréés pour ce véhicule"
                                nolabel="1"/>
                            <field name="tow_partner_count" invisible="1"/>
                        </group>
                        
                    </page>
                </xpath>
                
            </field>
        </record>
        
    </data>
</odoo>
